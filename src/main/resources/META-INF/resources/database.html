<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="cache-control" content="no-cache"/>
	<meta charset="utf-8"/>
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	
	<title>Communities of Practice - Database</title>
	
	<link href="css/jquery.dataTables.min.css" rel="stylesheet">
	<link type="text/css" rel="stylesheet" href="https://static.redhat.com/libs/redhat/redhat-font/2/webfonts/red-hat-font.css" media="all" />
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/style2.css" type="text/css">
	
	<script src="js/jquery-1.11.3.min.js"></script>
	<script src="js/jquery.dataTables.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/ChartNew.js"></script>
	<script src="js/utils.js"></script>
	<script src="js/http.js"></script>
	<script>
		var jwtToken = "";
		var contextPath = "";
	</script>
	
	<style>
		textarea {
		  width: 100%;
		  height: 85%;
		}
	</style>
</head>
<body>

<style>
.container {
    display: inline-block;
    cursor: pointer;
    width: 50px !important;
}
.bar1, .bar2, .bar3 {
    width: 35px;
    height: 4px;
    background-color: #333;
    margin: 6px 0;
    transition: 0.4s;
}
.change .bar1 {
    -webkit-transform: rotate(-45deg) translate(-5px, 8px) ;
    transform: rotate(-45deg) translate(-5px, 8px) ;
}
.change .bar2 {
    opacity: 0;
}
.change .bar3 {
    -webkit-transform: rotate(45deg) translate(-8px, -8px) ;
    transform: rotate(45deg) translate(-8px, -8px) ;
}
.adjustment{
	padding-top: 0px !important;
	padding-bottom: 0px !important;
}
.adjustment>div{
	padding: 10px 10px !important;
}
</style>
<script>
function myFunction(x) {
    x.classList.toggle("change");
}
</script>

<div id="main_nav" class="navbar">
  <div class="navbar-header">
    <a href="/" class="navbar-brand2"><img role="logo" src="images/logo.svg"/>
    	<span class="navbar-brand3"></span>
    </a>
  </div>
  <div class="collapse navbar-collapse bs-example-js-navbar-collapse">
    <ul class="nav navbar-nav">
      <li class="dropdown">
        <a aria-expanded="false" aria-haspopup="true" role="button" data-toggle="dropdown" class="menu-title dropdown-toggle" href="#" id="drop2">
          Ninja Program
          <span class="caret"></span>
        </a>
        <ul aria-labelledby="drop2" class="dropdown-menu">
          <li><a href="scorecards.html">Scorecards</a></li>
          <li><a href="leaderboard.html">Leaderboard</a></li>
          <li><a href="events.html">Events</a></li>
          <li><a href="tasks.html">Tasks</a></li>
          <li><a href="https://docs.google.com/a/redhat.com/forms/d/e/1FAIpQLSdWGcCks2zKKnVoZFQz3CieLQDc1lsSex_Knwh_-eyRm0ZQTg/viewform">Registration Form</a></li>
          <li><a href="https://docs.google.com/spreadsheets/d/1E91hT_ZpySyvhnANxqZ7hcBSM2EEd9TqfQF-cavB8hQ">Responses Spreadsheet</a></li>
          <li><a href="support-trello-card.html">Support - Trello Query</a></li>
          <li><a href="support-trello-all.html">Support - Trello Reconcilliation</a></li>
        </ul>
      </li>
    </ul>
    <ul class="nav navbar-nav">
      <li class="dropdown">
        <a aria-expanded="false" aria-haspopup="true" role="button" data-toggle="dropdown" class="menu-title dropdown-toggle" href="#" id="drop2">
          Admin
          <span class="caret"></span>
        </a>
        <ul aria-labelledby="drop2" class="dropdown-menu">
          <li><a href="config.html">Config (Here be dragons!)</a></li>
          <li><a href="database.html">Database (Here be dragons!)</a></li>
        </ul>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown" id="fat-menu">
        <a aria-expanded="false" aria-haspopup="true" role="button" data-toggle="dropdown" class="dropdown-toggle adjustment" href="#" id="drop3">
          <div class="container" onclick="myFunction(this)" style="height:56px">
					  <div class="bar1"></div>
					  <div class="bar2"></div>
					  <div class="bar3"></div>
					</div>
          <span class="caretx"></span>
        </a>
        <ul aria-labelledby="drop3" class="dropdown-menu">
          <li><a href="api/logout">Log out</a></li>
        </ul>
      </li>
    </ul>
  </div>
</div>

<div class="navbar-connector"></div>
<div class="navbar-title">
	<h2><span class="navbar-title-text">Database</span></h2>
</div>

<div class="alert alert-success" id="success-alert" style="display:none;">
    <button type="button" class="close" data-dismiss="alert">x</button>
    <strong>Success!</strong> database saved.
</div>

<div id="solutions">
	<textarea id="database" name="database"></textarea>
	<button name="save" onclick="save();">Save</button>
</div>

<script>
function save(){
	var newDb=document.getElementById("database").value;
	var payload=JSON.parse(newDb);
	post("/api/database/save", payload);
}

function post(uri, data){
  var xhr = new XMLHttpRequest();
  xhr.open("POST", uri, true);
  xhr.setRequestHeader("Content-Type", "application/json");
  if (data != undefined){
    xhr.send(JSON.stringify(data));
  }else{
    xhr.send();
  }
  xhr.onloadend = function () {
  	showSuccess();
  	load();
  };
}

function load(){
  var xhr = new XMLHttpRequest();
  xhr.open("GET", "/api/database/get", true);
  xhr.send();
  xhr.onloadend = function () {
    var json=JSON.parse(xhr.responseText);
    var obj=JSON.stringify(json, null, "\t");
    document.getElementById("database").value=obj;
  }
}

$(document).ready (function(){
  $("#success-alert").hide();
  load();
});

function showSuccess(){
  $("#success-alert").fadeTo(2000, 500).slideUp(500, function(){
		$("#success-alert").slideUp(500);
	}); 
}
</script>

</body>
</html>

